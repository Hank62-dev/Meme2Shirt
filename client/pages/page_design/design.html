<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Meme Shirt Final</title>
    <!-- Favicon -->
    <link
      rel="icon"
      type="image/png"
      href="/client/assets/img/logo/logoMemeShirt.png"
    />

    <!-- Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Black+Ops+One&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Freehand&family=Black+Ops+One&family=Inter:wght@400;500;600&family=Lobster&family=Oswald&family=Pacifico&family=Anton&family=Dancing+Script&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/client/pages/page_design/design.css">
    
  </head>
  <body>
    <div class="design-wrapper">
      <header>
        <div class="tabBars">
          <div class="toolBarLeft">
            <div class="logoMeme">
              <img
                src="/client/assets/img/logo/logoMemeShirt.png"
                alt="Logo Meme Shirt"
              />
            </div>
            <!-- <div class="titleMemeShirt" style="margin: auto 0">
              <h1>Meme Shirt</h1>
            </div> -->
          </div>
          <div class="toolBarCenter">
            <nav>
              <ul>
                <li><a href="/client/pages/page_home/index.html">Home</a></li>
                <li><a href="/">Menu</a></li>
                <li><a href="#designNow">Design</a></li>
                <li><a href="/client/pages/page_cart/cart.html">Cart</a></li>
                <li><a href="/client/pages/">Orders</a></li>
              </ul>
            </nav>
          </div>
          <div class="toolBarRight">
            <div class="searchBar">
              <svg
                class="iconSearch"
                width="35"
                height="35"
                viewBox="0 0 35 35"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M30.625 30.625L24.2812 24.2812M27.7083 16.0417C27.7083 22.485 22.485 27.7083 16.0417 27.7083C9.59834 27.7083 4.375 22.485 4.375 16.0417C4.375 9.59834 9.59834 4.375 16.0417 4.375C22.485 4.375 27.7083 9.59834 27.7083 16.0417Z"
                  stroke="#F3F3F3"
                  stroke-width="4"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </div>
            <div class="userAccount">
              <svg
                class="iconAccount"
                width="35"
                height="35"
                viewBox="0 0 35 35"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M29.1667 30.625V27.7083C29.1667 26.1612 28.5521 24.6775 27.4582 23.5835C26.3642 22.4896 24.8805 21.875 23.3334 21.875H11.6667C10.1196 21.875 8.63588 22.4896 7.54192 23.5835C6.44796 24.6775 5.83337 26.1612 5.83337 27.7083V30.625M23.3334 10.2083C23.3334 13.43 20.7217 16.0417 17.5 16.0417C14.2784 16.0417 11.6667 13.43 11.6667 10.2083C11.6667 6.98667 14.2784 4.375 17.5 4.375C20.7217 4.375 23.3334 6.98667 23.3334 10.2083Z"
                  stroke="#F3F3F3"
                  stroke-width="4"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </div>
            <div class="notification">
              <svg
                class="iconNoti"
                width="35"
                height="35"
                viewBox="0 0 35 35"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M5.83337 27.7084V24.7917H8.75004V14.5834C8.75004 12.5661 9.35768 10.7796 10.573 9.22404C11.7882 7.64418 13.3681 6.61119 15.3125 6.12508V5.10425C15.3125 4.49661 15.5191 3.98619 15.9323 3.573C16.3698 3.1355 16.8924 2.91675 17.5 2.91675C18.1077 2.91675 18.6181 3.1355 19.0313 3.573C19.4688 3.98619 19.6875 4.49661 19.6875 5.10425V6.12508C21.632 6.61119 23.2118 7.64418 24.4271 9.22404C25.6424 10.7796 26.25 12.5661 26.25 14.5834V24.7917H29.1667V27.7084H5.83337ZM17.5 32.0834C16.698 32.0834 16.0053 31.8039 15.4219 31.2449C14.8629 30.6615 14.5834 29.9688 14.5834 29.1667H20.4167C20.4167 29.9688 20.125 30.6615 19.5417 31.2449C18.9827 31.8039 18.3021 32.0834 17.5 32.0834ZM11.6667 24.7917H23.3334V14.5834C23.3334 12.9792 22.7622 11.606 21.6198 10.4636C20.4775 9.32126 19.1042 8.75008 17.5 8.75008C15.8959 8.75008 14.5226 9.32126 13.3802 10.4636C12.2379 11.606 11.6667 12.9792 11.6667 14.5834V24.7917Z"
                  fill="#FEF7FF"
                />
              </svg>
            </div>
          </div>
        </div>
      </header>

      <div class="body-container">
        <!-- Toolbar -->
        <div class="toolbar">
          <div class="tool-box" onclick="activatePanel('text', this)">
            <span class="cursive-txt">Text</span>
          </div>
          <div class="tool-box" onclick="activatePanel('meme', this)">
            <i class="far fa-star"></i>
            <span class="meme-text-icon">MEME</span>
          </div>
          <div class="tool-box" onclick="activatePanel('image', this)">
            <i class="far fa-image"></i>
          </div>
        </div>

        <!-- Panels Container -->
        <div class="panels-container" id="panels-container">
          <!-- Panel 1: Text Items -->
          <div id="panel-text" class="control-panel">
            <div
              class="text-style-item"
              draggable="true"
              ondragstart="handleDragStart(event)"
              style="font-family: 'Black Ops One'"
            >
              <span>Meme shirt</span>
            </div>
            <div
              class="text-style-item"
              draggable="true"
              ondragstart="handleDragStart(event)"
              style="font-family: 'Freehand'"
            >
              <span>Meme shirt</span>
            </div>
            <div
              class="text-style-item"
              draggable="true"
              ondragstart="handleDragStart(event)"
              style="font-family: 'Inter'"
            >
              <span>Meme shirt</span>
            </div>
            <div
              class="text-style-item"
              draggable="true"
              ondragstart="handleDragStart(event)"
              style="font-family: 'Lobster'"
            >
              <span>Meme shirt</span>
            </div>
            <div
              class="text-style-item"
              draggable="true"
              ondragstart="handleDragStart(event)"
              style="font-family: 'Oswald'"
            >
              <span>Meme shirt</span>
            </div>
            <div
              class="text-style-item"
              draggable="true"
              ondragstart="handleDragStart(event)"
              style="font-family: 'Pacifico'"
            >
              <span>Meme shirt</span>
            </div>
            <div
              class="text-style-item"
              draggable="true"
              ondragstart="handleDragStart(event)"
              style="font-family: 'Anton'"
            >
              <span>Meme shirt</span>
            </div>
            <div
              class="text-style-item"
              draggable="true"
              ondragstart="handleDragStart(event)"
              style="font-family: 'Dancing Script'"
            >
              <span>Meme shirt</span>
            </div>
          </div>

          <!-- Panel 2: Meme Items (Có Ngôi sao) -->
          <div id="panel-meme" class="control-panel">
            <div class="grid-container-2col">
              <!-- ITEM NGÔI SAO -->
              <div
                class="square-item"
                draggable="true"
                ondragstart="handleDragStart(event)"
              >
                <div
                  style="
                    width: 100%;
                    height: 100%;
                    background: #a03030;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                  "
                >
                  <i
                    class="fas fa-star"
                    style="font-size: 5rem; color: gold"
                  ></i>
                </div>
              </div>

              <!-- ITEM MẶT CƯỜI -->
              <div
                class="square-item"
                draggable="true"
                ondragstart="handleDragStart(event)"
              >
                <div
                  style="
                    width: 100%;
                    height: 100%;
                    background: #4a8db7;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                  "
                >
                  <i
                    class="fas fa-smile"
                    style="font-size: 5rem; color: white"
                  ></i>
                </div>
              </div>
            </div>
          </div>

          <!-- Panel 3: Image Tools (Có Camera) -->
          <div id="panel-image" class="control-panel">
            <div class="grid-container-2col">
              <!-- 1. Upload -->
              <div class="image-tool-wrapper">
                <label
                  class="square-item panel-image-item"
                  draggable="true"
                  ondragstart="handleDragStart(event)"
                >
                  <input
                    type="file"
                    hidden
                    onchange="handlePanelFileUpload(this)"
                    accept="image/*"
                  />
                  <img src="../../assets/img/design_page/uploadImage.png"></img>
                </label>
                <div class="panel-image-label">
                  Upload <i class="far fa-image"></i>
                </div>
              </div>

              <!-- 2. URL -->
              <div class="image-tool-wrapper">
                <div
                  class="square-item panel-image-item"
                  draggable="true"
                  ondragstart="handleDragStart(event)"
                  onclick="handleUrlInput(this)"
                >
                  <img src="../../assets/img/design_page/url.png"></img>
                </div>
                <div class="panel-image-label">
                  URL <i class="far fa-image"></i>
                </div>
              </div>

              <!-- 3. ITEM CAMERA (Đã bổ sung) -->
              <div class="image-tool-wrapper">
                <div
                  class="square-item panel-image-item"
                  draggable="true"
                  ondragstart="handleDragStart(event)"
                >
                  <img src="../../assets/img/design_page/camera.png"></img>
                </div>
                <div class="panel-image-label">Camera</div>
              </div>

              <!-- 4. Upload Meme -->
              <div class="image-tool-wrapper">
                <label
                  class="square-item panel-image-item"
                  draggable="true"
                  ondragstart="handleDragStart(event)"
                >
                  <input
                    type="file"
                    hidden
                    onchange="handlePanelFileUpload(this)"
                    accept="image/*"
                  />
                  <img src="../../assets/img/design_page/meme.png"></img>
                </label>
                <div class="panel-image-label">Upload meme</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
          <h1 class="page-title">Meme Gender</h1>
          <div class="content-layout">
            <div class="col-left">
              <!-- Drop Zone 1 -->
              <div
                class="grey-box box-small"
                ondrop="handleDrop(event, 'zone1')"
                ondragover="handleDragOver(event)"
                ondragleave="handleDragLeave(event)"
              >
                <span>Input Meme</span>
              </div>
              <!-- Drop Zone 2 -->
              <div
                class="grey-box box-small"
                ondrop="handleDrop(event, 'zone2')"
                ondragover="handleDragOver(event)"
                ondragleave="handleDragLeave(event)"
              >
                <span>Input Your Image</span>
              </div>
            </div>

            <div class="col-right">
              <div class="grey-box box-large">
                <canvas id="result-canvas"></canvas>
                <span
                  id="canvas-placeholder"
                  style="color: #666; font-size: 2rem"
                  >Result will appear here</span
                >
              </div>
              <div class="buttons-group">
                <button class="btn-design btn-blue" onclick="generateMeme()">
                  Gender
                </button>
                <button class="btn-design btn-white" onclick="downloadMeme()">
                 Add to cart
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Script Logic -->
    <script>
      const canvasData = {
        zone1: null,
        zone2: null,
      };

      // 1. Navigation
      function activatePanel(panelId, element) {
        document
          .querySelectorAll(".control-panel")
          .forEach((p) => p.classList.remove("active"));
        document
          .querySelectorAll(".tool-box")
          .forEach((t) => t.classList.remove("active"));

        document.getElementById("panels-container").style.display = "block";

        const target = document.getElementById(`panel-${panelId}`);
        if (target) target.classList.add("active");
        if (element) element.classList.add("active");
      }

      // 2. Upload & URL
      function handlePanelFileUpload(input) {
        if (input.files && input.files[0]) {
          const reader = new FileReader();
          reader.onload = function (e) {
            const parentLabel = input.closest(".square-item");
            parentLabel.querySelectorAll("i, span").forEach((i) => i.remove());

            let existingImg = parentLabel.querySelector("img");
            if (existingImg) {
              existingImg.src = e.target.result;
            } else {
              const imgHTML = `<img src="${e.target.result}" style="width:100%; height:100%; object-fit:cover; pointer-events:none;">`;
              parentLabel.insertAdjacentHTML("beforeend", imgHTML);
            }
          };
          reader.readAsDataURL(input.files[0]);
        }
      }

      function handleUrlInput(element) {
        const url = prompt(
          "Please enter image URL:",
          "https://via.placeholder.com/150"
        );
        if (url) {
          element.innerHTML = "";
          const imgHTML = `<img src="${url}" style="width:100%; height:100%; object-fit:cover; pointer-events:none;" onerror="this.src=''; alert('Invalid URL');">`;
          element.innerHTML = imgHTML;
        }
      }

      // 3. Drag
      function handleDragStart(e) {
        const target =
          e.target.closest(".text-style-item") ||
          e.target.closest(".square-item");
        if (!target) return;

        let dragData = { type: "unknown", content: "" };

        if (target.classList.contains("text-style-item")) {
          dragData.type = "text";
          dragData.content = target.innerText.trim();
          dragData.font = target.style.fontFamily.replace(/['"]/g, "");
        } else if (target.classList.contains("square-item")) {
          const imgInside = target.querySelector("img");
          if (imgInside) {
            dragData.type = "image";
            dragData.src = imgInside.src;
          } else {
            dragData.type = "element";
            // CLONE & CLEAN INPUTS
            let clone = target.cloneNode(true);
            let inputs = clone.querySelectorAll("input");
            inputs.forEach((i) => i.remove());
            dragData.content = clone.innerHTML;

            const coloredDiv = target.querySelector("div[style*='background']");
            if (coloredDiv) {
              dragData.bgColor = coloredDiv.style.backgroundColor;
            }
          }
        }

        e.dataTransfer.setData("text/plain", JSON.stringify(dragData));
        e.dataTransfer.effectAllowed = "copy";
      }

      // 4. Drop
      function handleDragOver(e) {
        e.preventDefault();
        e.dataTransfer.dropEffect = "copy";
        e.currentTarget.classList.add("drag-over");
      }

      function handleDragLeave(e) {
        e.currentTarget.classList.remove("drag-over");
      }

      function handleDrop(e, zoneId) {
        e.preventDefault();
        const dropZone = e.currentTarget;
        dropZone.classList.remove("drag-over");

        if (e.dataTransfer.files && e.dataTransfer.files.length > 0) {
          const file = e.dataTransfer.files[0];
          if (!file.type.startsWith("image/")) return;

          const reader = new FileReader();
          reader.onload = (evt) => {
            dropZone.innerHTML = "";
            const img = document.createElement("img");
            img.src = evt.target.result;
            img.className = "dropped-content-img";
            dropZone.appendChild(img);
            canvasData[zoneId] = { type: "image", src: evt.target.result };
          };
          reader.readAsDataURL(file);
          return;
        }

        try {
          const rawData = e.dataTransfer.getData("text/plain");
          if (!rawData) return;
          const data = JSON.parse(rawData);

          dropZone.innerHTML = "";

          if (data.type === "text") {
            const textEl = document.createElement("div");
            textEl.className = "dropped-content-text";
            textEl.innerText = data.content;
            textEl.style.fontFamily = data.font;
            dropZone.appendChild(textEl);
            canvasData[zoneId] = data;
          } else if (data.type === "image") {
            const img = document.createElement("img");
            img.src = data.src;
            img.className = "dropped-content-img";
            dropZone.appendChild(img);
            canvasData[zoneId] = data;
          } else if (data.type === "element") {
            const elContainer = document.createElement("div");
            elContainer.style.width = "100%";
            elContainer.style.height = "100%";
            elContainer.style.display = "flex";
            elContainer.style.justifyContent = "center";
            elContainer.style.alignItems = "center";
            elContainer.innerHTML = data.content;
            dropZone.appendChild(elContainer);
            canvasData[zoneId] = data;
          }
        } catch (err) {
          console.error("Drop error:", err);
        }
      }
    </script>
  </body>
</html>
